"use strict";function each(e,t){for(var n=0;n<e.length;n++)t(e[n],n)}function createFragment(e){if(e=e.replace(/&/g,"&amp;"),e.indexOf("<!doctype")>=0)return[(new DOMParser).parseFromString(e,"text/html").childNodes[1]];var t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),t.childNodes}function createVirtual(e){var t=[];return each(e,function(e){if(3===e.nodeType)t.push(e.nodeValue);else if(1===e.nodeType){var n={};each(e.attributes,function(e){n[e.name]=e.value});var r=e.nodeName.toLowerCase(),i=svgCaseSensitiveTagNamesMap[r]?svgCaseSensitiveTagNamesMap[r]:r;t.push({tag:i,attrs:n,children:createVirtual(e.childNodes)})}}),t}function TemplateBuilder(e){this.virtual=e,this.children=[]}var ENTITY_REGEX=/(\&#?\w+;)/,svgCaseSensitiveTagNames=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"],svgCaseSensitiveTagNamesMap={};svgCaseSensitiveTagNames.forEach(function(e){svgCaseSensitiveTagNamesMap[e.toLowerCase()]=e}),TemplateBuilder.prototype={addVirtualString:function(e){var t=this,n=e.replace(/(["\r\n])/g,"\\$1"),r=n.split(ENTITY_REGEX);r.length>1?r.forEach(function(e){e.match(ENTITY_REGEX)?t.children.push({content:'m.trust("'+e+'")'}):e&&t.children.push({content:'"'+e+'"'})}):this.children.push({content:'"'+n+'"'})},addVirtualAttrs:function(e,t){var n=t.attributeQuote,r=t.quote,i="div"===e.tag?"":e.tag;if(e.attrs.class){var a=e.attrs.class.replace(/\s+/g,".");i+="."+a,e.attrs.class=void 0}if(each(Object.keys(e.attrs).sort(),function(t){if("style"!==t&&void 0!==e.attrs[t]){var r=e.attrs[t];r=r.replace(/[\n\r\t]/g," "),r=r.replace(/\s+/g," "),r=r.replace(/'/g,"\\'"),i+="["+t+"="+n+r+n+"]"}}),""===i&&(i="div"),i=""+r+i+r,e.attrs.style){var l=e.attrs.style.replace(/(^.*);\s*$/,"$1");l=l.replace(/[\n\r]/g,""),l=l.split(/\s*;\s*/),l=l.map(function(e){return e.split(/\s*:\s*/).map(function(e){return"${quote}"+e+"${quote}"}).join(": ")}),l=l.join(", "),i+=", {style: {"+l+"}}"}var o=0!==e.children.length?new TemplateBuilder(e.children).complete(t):null;this.children.push({node:i,children:o})},complete:function(e){return each(this.virtual,function(t){"string"==typeof t?!/(^\s*$)|(^\"$)/.test(t)&&t.charCodeAt()>=32&&this.addVirtualString(t):this.addVirtualAttrs(t,e)}.bind(this)),this.children}};var whitespace=function(e,t){if(e<0)return"";for(var n="",r=0;r<e;r++)n+=t;return n},wrapperTemplate=function(e){return"["+e+"\n]"},contentTemplate=function(e,t){return"\n"+t+e},singleMithrilNodeTemplate=function(e){var t=e.mithrilNode;return"\n"+e.whitespace+"m("+t+")"},mithrilNodeMultipleChildrenTemplate=function(e){var t=e.mithrilNode,n=e.children,r=e.whitespace,i=e.indent;return"\n\n"+r+"m("+t+", "+(e.useBracket?"[\n"+n+"\n"+r+i+"]\n":"\n"+n+"\n"+r+i)+"\n"+r+")"},mithrilNodeSingleChildTemplate=function(e){var t=e.mithrilNode,n=e.children,r=e.whitespace;return"\n"+r+"m("+t+", "+n+"\n"+r+")"},template=function(e){return e.children?e.children.length>1?mithrilNodeMultipleChildrenTemplate(e):mithrilNodeSingleChildTemplate(e):singleMithrilNodeTemplate(e)},formatCode=function e(t,n){if(!t)return"";var r=n.level,i=n.indent;return t.map(function(t){var a=whitespace(r,i);if(t.content)return contentTemplate(t.content,a);var l=t.node||"",o=r+(t.children&&t.children.length>1?2:1),s=e(t.children,Object.assign({},n,{level:o}))||"";return template(Object.assign({},n,{mithrilNode:l,children:s,whitespace:a,indent:i}))})},indentCharsMap={2:"  ",4:"    ",tab:"\t"},templateBuilder=function(e){var t=e.quotes||{quote:"'",attrQuote:'"'},n=createVirtual(createFragment(e.source)),r=new TemplateBuilder(n).complete(t),i=r.length>1?1:0,a=indentCharsMap[e.indent||"4"],l=e.useBracket||!1,o=formatCode(r,{level:i,indent:a,useBracket:l});return o.length>1?wrapperTemplate(o.join(", ")):o.join("").trim()};"undefined"!=typeof module&&null!==module&&module.exports?module.exports=templateBuilder:"function"==typeof define&&define.amd&&define(function(){return templateBuilder});