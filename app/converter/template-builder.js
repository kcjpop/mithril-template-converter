"use strict";function each(e,t){for(var n=0;n<e.length;n++)t(e[n],n)}function createFragment(e){if(e=e.replace(/&/g,"&amp;"),e.indexOf("<!doctype")>=0)return[(new DOMParser).parseFromString(e,"text/html").childNodes[1]];var t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),t.childNodes}function createVirtual(e){var t=[];return each(e,function(e){if(3===e.nodeType)t.push(e.nodeValue);else if(1===e.nodeType){var n={};each(e.attributes,function(e){n[e.name]=e.value});var r=e.nodeName.toLowerCase(),i=svgCaseSensitiveTagNamesMap[r]?svgCaseSensitiveTagNamesMap[r]:r;t.push({tag:i,attrs:n,children:createVirtual(e.childNodes)})}}),t}function TemplateBuilder(e){this.virtual=e,this.children=[]}var QUOTE="'",ATTRIBUTE_QUOTE='"',ENTITY_REGEX=/(\&#?\w+;)/,svgCaseSensitiveTagNames=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"],svgCaseSensitiveTagNamesMap={};svgCaseSensitiveTagNames.forEach(function(e){svgCaseSensitiveTagNamesMap[e.toLowerCase()]=e}),TemplateBuilder.prototype={addVirtualString:function(e){var t=this,n=e.replace(/(["\r\n])/g,"\\$1"),r=n.split(ENTITY_REGEX);r.length>1?r.forEach(function(e){e.match(ENTITY_REGEX)?t.children.push({content:'m.trust("'+e+'")'}):e&&t.children.push({content:'"'+e+'"'})}):this.children.push({content:'"'+n+'"'})},addVirtualAttrs:function(e){var t="div"===e.tag?"":e.tag;if(e.attrs.class){var n=e.attrs.class.replace(/\s+/g,".");t+="."+n,e.attrs.class=void 0}if(each(Object.keys(e.attrs).sort(),function(n){if("style"!==n&&void 0!==e.attrs[n]){var r=e.attrs[n];r=r.replace(/[\n\r\t]/g," "),r=r.replace(/\s+/g," "),r=r.replace(/'/g,"\\'"),t+="["+n+"="+ATTRIBUTE_QUOTE+r+ATTRIBUTE_QUOTE+"]"}}),""===t&&(t="div"),t=""+QUOTE+t+QUOTE,e.attrs.style){var r=e.attrs.style.replace(/(^.*);\s*$/,"$1");r=r.replace(/[\n\r]/g,""),r=r.split(/\s*;\s*/),r=r.map(function(e){return e.split(/\s*:\s*/).map(function(e){return"${QUOTE}"+e+"${QUOTE}"}).join(": ")}),r=r.join(", "),t+=", {style: {"+r+"}}"}var i=0!==e.children.length?new TemplateBuilder(e.children).complete():null;this.children.push({node:t,children:i})},complete:function(){return each(this.virtual,function(e){"string"==typeof e?!/(^\s*$)|(^\"$)/.test(e)&&e.charCodeAt()>=32&&this.addVirtualString(e):this.addVirtualAttrs(e)}.bind(this)),this.children}};var whitespace=function(e,t){if(e<0)return"";for(var n="",r=0;r<e;r++)n+=t;return n},wrapperTemplate=function(e){return"["+e+"\n]"},contentTemplate=function(e,t){return"\n"+t+e},singleMithrilNodeTemplate=function(e){var t=e.mithrilNode;return"\n"+e.whitespace+"m("+t+")"},mithrilNodeMultipleChildrenTemplate=function(e){var t=e.mithrilNode,n=e.children,r=e.whitespace,i=e.indent;return"\n\n"+r+"m("+t+", "+(e.useBracket?"[\n"+n+"\n"+r+i+"]\n":"\n"+n+"\n"+r+i)+"\n"+r+")"},mithrilNodeSingleChildTemplate=function(e){var t=e.mithrilNode,n=e.children,r=e.whitespace;return"\n"+r+"m("+t+", "+n+"\n"+r+")"},template=function(e){return e.children?e.children.length>1?mithrilNodeMultipleChildrenTemplate(e):mithrilNodeSingleChildTemplate(e):singleMithrilNodeTemplate(e)},formatCode=function e(t,n){if(!t)return"";var r=n.level,i=n.indent;return t.map(function(t){var a=whitespace(r,i);if(t.content)return contentTemplate(t.content,a);var l=t.node||"",s=r+(t.children&&t.children.length>1?2:1),o=e(t.children,Object.assign({},n,{level:s}))||"";return template(Object.assign({},n,{mithrilNode:l,children:o,whitespace:a,indent:i}))})},indentCharsMap={2:"  ",4:"    ",tab:"\t"},templateBuilder=function(e){var t=createVirtual(createFragment(e.source)),n=new TemplateBuilder(t).complete(),r=n.length>1?1:0,i=indentCharsMap[e.indent||"4"],a=e.useBracket||!1,l=e.quotes||{quote:"'",attrQuote:'"'},s=formatCode(n,{level:r,indent:i,useBracket:a,quotes:l});return s.length>1?wrapperTemplate(s.join(", ")):s.join("").trim()};"undefined"!=typeof module&&null!==module&&module.exports?module.exports=templateBuilder:"function"==typeof define&&define.amd&&define(function(){return templateBuilder});